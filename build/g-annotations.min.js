!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.gAnnotations=t.gAnnotations||{},t.d3)}(this,function(t,e){"use strict";t.annotations=function(){let t=20,a=[100,100],n=e.scaleLinear(),r=e.scaleLinear(),s=1,l=[],o=16,i=e.scaleSqrt(),c=(e.format(".2f"),"");function d(s){const l=s.append("g").on("mouseover",function(t){this.style.cursor="pointer"});let c=!1,d=!1;"function"==typeof n.bandwidth&&(c=!0),"function"==typeof r.bandwidth&&(d=!0),l.selectAll("line").data(t=>t.annotations.filter(t=>"threshold"===t.type)).enter().append("line").attr("class","annotation").attr("x1",t=>r(t.targetX)).attr("x2",t=>r(t.targetX)).attr("y1",n.range()[0]).attr("y2",n.range()[1]),l.selectAll("text").data(t=>t.annotations.filter(t=>"threshold"===t.type)).enter().append("text").attr("class","highlighted-label").attr("text-anchor","middle").attr("x",t=>r(t.targetX)).attr("y",n.range()[1]-o/2).text(t=>t.title);let p=l.selectAll("text").data(t=>t.annotations.filter(t=>"curve"===t.type||"elbow"===t.type||"arc"===t.type)).enter().append("g");function f(t,e,a,s){let l=u(t),p=r(s.targetX),f=n(s.targetY);c&&(f=n(s.targetY)+.5*n.bandwidth()),d&&(p=n(s.targetX)+.5*r.bandwidth());let h,x,y=[e,e+l[0],a,a+l[1]],g=400,m=400,b=20,v=20,w=s.radius;p>y[0]&&p>y[1]&&f>y[2]&&f>y[3]&&(g=(h=e+l[0])+.3*(p-h),m=(x=a+l[1]/2)-o,b=p-.05*(p-h),v=f-.8*(f-x)),p<y[1]&&p>y[0]&&f>y[2]&&f>y[3]&&(g=h=e+l[0]/2,m=(x=a+l[1])+.2*(f-x),b=p-.6*(p-h),v=f-.1*(f-x)),p<y[0]&&p<y[1]&&f>y[2]&&f>y[3]&&(g=(h=e)-.3*(h-p),m=(x=a+l[1]/2)-o,b=p+.05*(h-p),v=f-.8*(f-x)),p>y[0]&&p>y[1]&&f>y[2]&&f<y[3]&&(g=(h=e+l[0])+.2*(p-h),m=(x=a+l[1]/2)-o,b=p-.1*(p-h),v=f-.4*(f-x)),p<y[1]&&p>y[0]&&f>y[2]&&f<y[3]&&(h=e+l[0]/2,x=a+l[1]/2),p<y[0]&&p<y[1]&&f>y[2]&&f<y[3]&&(g=(h=e)-.2*(h-p),m=(x=a+l[1]/2)-o,b=p+.05*(p-h),v=f-.8*(f-x)),p>y[0]&&p>y[1]&&f<y[2]&&f<y[3]&&(g=(h=e+l[0])+.3*(p-h),m=(x=a+l[1]/2)-o,b=p-.3*(p-h),v=f+.6*(x-f)),p<y[1]&&p>y[0]&&f<y[2]&&f<y[3]&&(g=h=e+l[0]/2,m=(x=a)+.6*(f-x),b=p-.1*(p-h),v=f-.4*(f-x)),p<y[0]&&p<y[1]&&f<y[2]&&f<y[3]&&(g=(h=e)-.3*(h-p),m=(x=a+l[1]/2)-o,b=p+.2*(h-p),v=f+.6*(x-f));var X=h-p,A=x-f,M=Math.atan2(X,A);let j,L=i(w)*Math.sin(M),Y=i(w)*Math.cos(M);return Math.sqrt(X*X+A*A),"elbow"===s.type&&(j="M "+h+","+(x-o)+" L "+g+","+m+"L"+p+","+f),"arc"===s.type&&(j="M "+h+","+(x-o)+" C "+g+","+m+" "+b+","+v+" "+p+","+f),"curve"!==s.type&&""!==s.type||(j="M"+h+","+(x-o)+"Q"+g+","+m+" "+(p+L)+","+(f+Y)),j}function u(t){return[t.node().getBBox().width,t.node().getBBox().height]}p.append("text").attr("class","highlighted-label").attr("x",t=>r(t.targetX)).attr("y",t=>n(t.targetY)).attr("dy",0).text(t=>t.title).call(function(t,a,n,r){t.each(function(){for(var t,s=e.select(this),l=s.text().split(/\s+/).reverse(),o=[],i=0,c=s.attr("y"),d=parseFloat(s.attr("dy")),p=s.text(null).append("tspan").attr("class",r).attr("x",n).attr("y",c).attr("dy",d+"em");t=l.pop();)o.push(t),p.text(o.join(" ")),p.node().getComputedTextLength()>a&&(o.pop(),p.text(o.join(" ")),o=[t],p=s.append("tspan").attr("class",r).attr("x",n).attr("y",c).attr("dy",`${1.1*++i+d}em`).text(t))})},t,t=>r(t.targetX),"highlighted-label").attr("transform",function(t,s){const l=function(t,s){let l=u(e.select(s)),c=r(t.targetX),d=n(t.targetY),p=t.radius,f=0,h=0;return c>a[0]/2&&(f=0-(l[0]+i(p)+o)),c<a[0]/2&&(f=i(p)+o),d>a[1]/2&&(h=0-(l[1]+i(p)+o)),d<a[1]/2&&(h=l[1]+i(p)+o),[f,h]}(t,this);return`translate(${l[0]},${l[1]})`}),p.append("path").attr("id","arrow").attr("class","annotation").attr("fill","none").attr("d",function(t){let a=e.select(this.parentNode).select("text"),s=[a.node().transform.baseVal[0].matrix.e,a.node().transform.baseVal[0].matrix.f];return f(a,r(t.targetX)+s[0],n(t.targetY)+s[1],t)}),p.call(e.drag().subject(function(){const t=e.select(this).select("text");return{x:t.attr("x"),y:t.attr("y")}}).on("start",function(t){e.select(this).raise().classed("active",!0)}).on("drag",function(t){let a=e.select(this).select("text"),n=[a.node().transform.baseVal[0].matrix.e,a.node().transform.baseVal[0].matrix.f],r=e.event.x+n[0],s=e.event.y+n[1];e.select(this).selectAll("tspan").attr("x",t.x=e.event.x).attr("y",t.y=e.event.y),e.select(this).selectAll("text").attr("x",t.x=e.event.x).attr("y",t.y=e.event.y),e.select(this).selectAll("path").attr("d",function(t){let e=f(a,r,s,t);return e})}).on("end",function(t){e.select(this).classed("active",!1)}))}return e.scaleOrdinal(),d.frameName=(t=>(c=t,d)),d.lineWidth=(e=>e?(t=e,d):t),d.plotDim=(t=>t?(a=t,d):window.plotDim),d.rem=(t=>t?(o=t,d):o),d.scaleFactor=(t=>t?(s=t,d):s),d.seriesNames=(t=>void 0===t?l:(l=t,d)),d.sizeScale=(t=>t?(i=t,d):i),d.xScale=(t=>t?(r=t,d):r),d.yScale=(t=>t?(n=t,d):n),d},Object.defineProperty(t,"__esModule",{value:!0})});
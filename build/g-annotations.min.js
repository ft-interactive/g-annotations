!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.gAnnotations=t.gAnnotations||{},t.d3)}(this,function(t,e){"use strict";t.annotations=function(){let t=[100,100],a=e.scaleLinear(),n=e.scaleLinear(),r=1,l=[],s=16,i=e.scaleSqrt(),o=(e.format(".2f"),"");function c(r){const l=r.append("g").on("mouseover",function(t){this.style.cursor="pointer"});let o=!1,c=!1;"function"==typeof a.bandwidth&&(o=!0),"function"==typeof n.bandwidth&&(c=!0),l.selectAll("line").data(t=>t.annotations.filter(t=>"threshold"===t.type)).enter().append("line").attr("class","annotation").attr("x1",t=>n(t.targetX)).attr("x2",t=>n(t.targetX)).attr("y1",a.range()[0]).attr("y2",a.range()[1]),l.selectAll("text").data(t=>t.annotations.filter(t=>"threshold"===t.type)).enter().append("text").attr("class","highlighted-label").attr("text-anchor","middle").attr("x",t=>n(t.targetX)).attr("y",a.range()[1]-s/2).text(t=>t.title);let d=l.selectAll("text").data(t=>t.annotations.filter(t=>"curve"===t.type||"elbow"===t.type||"arc"===t.type)).enter().append("g");function p(t,e,r,l){let d=h(t),p=n(l.targetX),f=a(l.targetY);o&&(f=a(l.targetY)+.5*a.bandwidth()),c&&(p=a(l.targetX)+.5*n.bandwidth());let u,x,y=[e,e+d[0],r,r+d[1]],g=400,m=400,b=20,v=20,w=l.radius;p>y[0]&&p>y[1]&&f>y[2]&&f>y[3]&&(g=(u=e+d[0])+.3*(p-u),m=(x=r+d[1]/2)-s,b=p-.05*(p-u),v=f-.8*(f-x)),p<y[1]&&p>y[0]&&f>y[2]&&f>y[3]&&(g=u=e+d[0]/2,m=(x=r+d[1])+.2*(f-x),b=p-.6*(p-u),v=f-.1*(f-x)),p<y[0]&&p<y[1]&&f>y[2]&&f>y[3]&&(g=(u=e)-.3*(u-p),m=(x=r+d[1]/2)-s,b=p+.05*(u-p),v=f-.8*(f-x)),p>y[0]&&p>y[1]&&f>y[2]&&f<y[3]&&(g=(u=e+d[0])+.2*(p-u),m=(x=r+d[1]/2)-s,b=p-.1*(p-u),v=f-.4*(f-x)),p<y[1]&&p>y[0]&&f>y[2]&&f<y[3]&&(u=e+d[0]/2,x=r+d[1]/2),p<y[0]&&p<y[1]&&f>y[2]&&f<y[3]&&(g=(u=e)-.2*(u-p),m=(x=r+d[1]/2)-s,b=p+.05*(p-u),v=f-.8*(f-x)),p>y[0]&&p>y[1]&&f<y[2]&&f<y[3]&&(g=(u=e+d[0])+.3*(p-u),m=(x=r+d[1]/2)-s,b=p-.3*(p-u),v=f+.6*(x-f)),p<y[1]&&p>y[0]&&f<y[2]&&f<y[3]&&(g=u=e+d[0]/2,m=(x=r)+.6*(f-x),b=p-.1*(p-u),v=f-.4*(f-x)),p<y[0]&&p<y[1]&&f<y[2]&&f<y[3]&&(g=(u=e)-.3*(u-p),m=(x=r+d[1]/2)-s,b=p+.2*(u-p),v=f+.6*(x-f));var X=u-p,A=x-f,M=Math.atan2(X,A);let j,L=i(w)*Math.sin(M),Y=i(w)*Math.cos(M);return Math.sqrt(X*X+A*A),"elbow"===l.type&&(j="M "+u+","+(x-s)+" L "+g+","+m+"L"+p+","+f),"arc"===l.type&&(j="M "+u+","+(x-s)+" C "+g+","+m+" "+b+","+v+" "+p+","+f),"curve"!==l.type&&""!==l.type||(j="M"+u+","+(x-s)+"Q"+g+","+m+" "+(p+L)+","+(f+Y)),j}function h(t){return[t.node().getBBox().width,t.node().getBBox().height]}d.append("text").attr("class","highlighted-label").attr("x",t=>n(t.targetX)).attr("y",t=>a(t.targetY)).attr("dy",0).text(t=>t.title).call(function(t,a,n,r){t.each(function(){for(var t,l=e.select(this),s=l.text().split(/\s+/).reverse(),i=[],o=0,c=l.attr("y"),d=parseFloat(l.attr("dy")),p=l.text(null).append("tspan").attr("class",r).attr("x",n).attr("y",c).attr("dy",d+"em");t=s.pop();)i.push(t),p.text(i.join(" ")),p.node().getComputedTextLength()>a&&(i.pop(),p.text(i.join(" ")),i=[t],p=l.append("tspan").attr("class",r).attr("x",n).attr("y",c).attr("dy",`${1.1*++o+d}em`).text(t))})},lineWidth,t=>n(t.targetX),"highlighted-label").attr("transform",function(r,l){const o=function(r,l){let o=h(e.select(l)),c=n(r.targetX),d=a(r.targetY),p=r.radius,f=0,u=0;return c>t[0]/2&&(f=0-(o[0]+i(p)+s)),c<t[0]/2&&(f=i(p)+s),d>t[1]/2&&(u=0-(o[1]+i(p)+s)),d<t[1]/2&&(u=o[1]+i(p)+s),[f,u]}(r,this);return`translate(${o[0]},${o[1]})`}),d.append("path").attr("id","arrow").attr("class","annotation").attr("fill","none").attr("d",function(t){let r=e.select(this.parentNode).select("text"),l=[r.node().transform.baseVal[0].matrix.e,r.node().transform.baseVal[0].matrix.f];return p(r,n(t.targetX)+l[0],a(t.targetY)+l[1],t)}),d.call(e.drag().subject(function(){const t=e.select(this).select("text");return{x:t.attr("x"),y:t.attr("y")}}).on("start",function(t){e.select(this).raise().classed("active",!0)}).on("drag",function(t){let a=e.select(this).select("text"),n=[a.node().transform.baseVal[0].matrix.e,a.node().transform.baseVal[0].matrix.f],r=e.event.x+n[0],l=e.event.y+n[1];e.select(this).selectAll("tspan").attr("x",t.x=e.event.x).attr("y",t.y=e.event.y),e.select(this).selectAll("text").attr("x",t.x=e.event.x).attr("y",t.y=e.event.y),e.select(this).selectAll("path").attr("d",function(t){let e=p(a,r,l,t);return e})}).on("end",function(t){e.select(this).classed("active",!1)}))}return e.scaleOrdinal(),c.frameName=(t=>(o=t,c)),c.lineWidth=(t=>t?(lineWidth=t,c):lineWidth),c.plotDim=(e=>e?(t=e,c):window.plotDim),c.rem=(t=>t?(s=t,c):s),c.scaleFactor=(t=>t?(r=t,c):r),c.seriesNames=(t=>void 0===t?l:(l=t,c)),c.sizeScale=(t=>t?(i=t,c):i),c.xScale=(t=>t?(n=t,c):n),c.yScale=(t=>t?(a=t,c):a),c},Object.defineProperty(t,"__esModule",{value:!0})});
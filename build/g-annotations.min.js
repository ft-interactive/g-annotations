!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.gAnnotations=t.gAnnotations||{},t.d3)}(this,function(t,e){"use strict";t.annotations=function(){let t=100,a=[100,100],n=e.scaleLinear(),r=e.scaleLinear(),s=1,l=[],o=16,i=e.scaleSqrt(),c=(e.format(".2f"),"");function d(s){const l=s.append("g").on("mouseover",function(t){this.style.cursor="pointer"});l.selectAll("line").data(t=>t.annotations.filter(t=>"threshold"===t.type)).enter().append("line").attr("class","annotation").attr("x1",t=>r(t.targetX)).attr("x2",t=>r(t.targetX)).attr("y1",n.range()[0]).attr("y2",n.range()[1]),l.selectAll("text").data(t=>t.annotations.filter(t=>"threshold"===t.type)).enter().append("text").attr("class","highlighted-label").attr("text-anchor","middle").attr("x",t=>r(t.targetX)).attr("y",n.range()[1]-o/2).text(t=>t.title);let c=l.selectAll("text").data(t=>t.annotations.filter(t=>"curve"===t.type||"elbow"===t.type||"arc"===t.type)).enter().append("g");function d(t,e,a,s){let l,c,d=p(t),u=r(s.targetX),x=n(s.targetY),f=[e,e+d[0],a,a+d[1]],h=400,y=400,g=20,m=20,v=s.radius;u>f[0]&&u>f[1]&&x>f[2]&&x>f[3]&&(h=(l=e+d[0])+.3*(u-l),y=(c=a+d[1]/2)-o,g=u-.05*(u-l),m=x-.8*(x-c)),u<f[1]&&u>f[0]&&x>f[2]&&x>f[3]&&(h=l=e+d[0]/2,y=(c=a+d[1])+.2*(x-c),g=u-.6*(u-l),m=x-.1*(x-c)),u<f[0]&&u<f[1]&&x>f[2]&&x>f[3]&&(h=(l=e)-.3*(l-u),y=(c=a+d[1]/2)-o,g=u+.05*(l-u),m=x-.8*(x-c)),u>f[0]&&u>f[1]&&x>f[2]&&x<f[3]&&(h=(l=e+d[0])+.2*(u-l),y=(c=a+d[1]/2)-o,g=u-.1*(u-l),m=x-.4*(x-c)),u<f[1]&&u>f[0]&&x>f[2]&&x<f[3]&&(l=e+d[0]/2,c=a+d[1]/2),u<f[0]&&u<f[1]&&x>f[2]&&x<f[3]&&(h=(l=e)-.2*(l-u),y=(c=a+d[1]/2)-o,g=u+.05*(u-l),m=x-.8*(x-c)),u>f[0]&&u>f[1]&&x<f[2]&&x<f[3]&&(h=(l=e+d[0])+.3*(u-l),y=(c=a+d[1]/2)-o,g=u-.3*(u-l),m=x+.6*(c-x)),u<f[1]&&u>f[0]&&x<f[2]&&x<f[3]&&(h=l=e+d[0]/2,y=(c=a)+.6*(x-c),g=u-.1*(u-l),m=x-.4*(x-c)),u<f[0]&&u<f[1]&&x<f[2]&&x<f[3]&&(h=(l=e)-.3*(l-u),y=(c=a+d[1]/2)-o,g=u+.2*(l-u),m=x+.6*(c-x));var b=l-u,A=c-x,M=Math.atan2(b,A);let X,w=i(v)*Math.sin(M),j=i(v)*Math.cos(M);return Math.sqrt(b*b+A*A),"elbow"===s.type&&(X="M "+l+","+(c-o)+" L "+h+","+y+"L"+u+","+x),"arc"===s.type&&(X="M "+l+","+(c-o)+" C "+h+","+y+" "+g+","+m+" "+u+","+x),"curve"!==s.type&&""!==s.type||(X="M"+l+","+(c-o)+"Q"+h+","+y+" "+(u+w)+","+(x+j)),X}function p(t){return[t.node().getBBox().width,t.node().getBBox().height]}c.append("text").attr("class","highlighted-label").attr("x",t=>r(t.targetX)).attr("y",t=>n(t.targetY)).attr("dy",0).text(t=>t.title).call(function(t,a,n,r){t.each(function(){for(var t,s=e.select(this),l=s.text().split(/\s+/).reverse(),o=[],i=0,c=s.attr("y"),d=parseFloat(s.attr("dy")),p=s.text(null).append("tspan").attr("class",r).attr("x",n).attr("y",c).attr("dy",d+"em");t=l.pop();)o.push(t),p.text(o.join(" ")),p.node().getComputedTextLength()>a&&(o.pop(),p.text(o.join(" ")),o=[t],p=s.append("tspan").attr("class",r).attr("x",n).attr("y",c).attr("dy",`${1.1*++i+d}em`).text(t))})},t,t=>r(t.targetX),"highlighted-label").attr("transform",function(t,s){const l=function(t,s){let l=p(e.select(s)),c=r(t.targetX),d=n(t.targetY),u=t.radius,x=0,f=0;return c>a[0]/2&&(x=0-(l[0]+i(u)+o)),c<a[0]/2&&(x=i(u)+o),d>a[1]/2&&(f=0-(l[1]+i(u)+o)),d<a[1]/2&&(f=l[1]+i(u)+o),[x,f]}(t,this);return`translate(${l[0]},${l[1]})`}),c.append("path").attr("id","arrow").attr("class","annotation").attr("stroke","#000000").attr("stroke-width",1).attr("d",function(t){let a=e.select(this.parentNode).select("text"),s=[a.node().transform.baseVal[0].matrix.e,a.node().transform.baseVal[0].matrix.f];return d(a,r(t.targetX)+s[0],n(t.targetY)+s[1],t)}),c.call(e.drag().subject(function(){const t=e.select(this).select("text");return console.log(t),{x:t.attr("x"),y:t.attr("y")}}).on("start",function(t){e.select(this).raise().classed("active",!0)}).on("drag",function(t){let a=e.select(this).select("text"),n=[a.node().transform.baseVal[0].matrix.e,a.node().transform.baseVal[0].matrix.f],r=e.event.x+n[0],s=e.event.y+n[1];e.select(this).selectAll("tspan").attr("x",t.x=e.event.x).attr("y",t.y=e.event.y),e.select(this).selectAll("text").attr("x",t.x=e.event.x).attr("y",t.y=e.event.y),e.select(this).selectAll("path").attr("d",function(t){let e=d(a,r,s,t);return e})}).on("end",function(t){e.select(this).classed("active",!1)}))}return e.scaleOrdinal(),d.frameName=(t=>(c=t,d)),d.lineWidth=(e=>e?(t=e,d):t),d.plotDim=(t=>t?(a=t,d):window.plotDim),d.rem=(t=>t?(o=t,d):o),d.scaleFactor=(t=>t?(s=t,d):s),d.seriesNames=(t=>void 0===t?l:(l=t,d)),d.sizeScale=(t=>t?(i=t,d):i),d.xScale=(t=>t?(r=t,d):r),d.yScale=(t=>t?(n=t,d):n),d},Object.defineProperty(t,"__esModule",{value:!0})});